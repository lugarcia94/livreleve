"use strict";var $register='<div class="custom__register">\n    <div class="register__content" v-show="!showItens">\n        <div class="form-controls">\n            <label class="form__label">Nome da personalização:</label>\n            <input class="field" name="field__custom__category" v-model="custom.category" placeholder="Digite o nome" autocomplete="off">\n        </div>\n\n        <div class="form__radio" :class="{ finishing: custom.tapy == \'customized-finishing\'}">\n            <div class="form__row">\n                <input type="radio" id="tapy__color" id="customized__color" value="customized-color" v-model="custom.tapy"/>\n                <label for="customized__color" class="label__radio">Cor</label>\n            </div>\n\n            <div class="form__row">\n                <input type="radio" id="fabric" id="customized__fabric" value="customized-fabric" v-model="custom.tapy"/>\n                <label for="customized__fabric" class="label__radio">Tecido</label>\n            </div>\n\n            <div class="form__row">\n                <input type="radio" id="finishing" id="customized__finishing" value="customized-finishing" v-model="custom.tapy"/>\n                <label for="customized__finishing" class="label__radio">Acabamento de Pintura</label>\n            </div>\n        </div>\n\n        <div class="form-controls" v-if="custom.tapy != \'customized-finishing\'">\n            <label class="form__label"> Descrição:</label>\n            <textarea class="field__textarea" v-model="custom.description"  placeholder="Digite a descrição"></textarea>\n        </div>\n\n        <div class="form-controls">\n            <button class="btn" @click="validadeFieldCategory()">\n                Cadastrar\n            </button>\n        </div>   \n    </div> \n\n    <div class="register__content"  v-show="showItens">\n        <div class="form-controls">\n            <label class="form__label">Nome:</label>\n            <input class="field" type="text" id="field__custom__ame" v-model="custom.name" placeholder="Nome" autocomplete="off"/> \n        </div>\n\n        <div class="form-controls form-controls-file">\n            <label class="form__label">Imagem:</label>\n            <input type="file" id="customized__image" @change="processFile($event)" /> \n        </div>\n\n        <div class="form-controls form-controls-finishing " v-if="custom.tapy == \'customized-finishing\'">\n            <label class="form__label"> Descrição:</label>\n            <textarea class="field__textarea" v-model="custom.description"  placeholder="Digite a descrição"></textarea>\n        </div>\n\n        <div class="form-controls">\n            <button class="btn" @click="validadeFieldCustom()">\n                Cadastrar\n            </button>\n        </div>\n\n        <div class="list-image-custom" v-if="files.images.length">\n            <header class="header-title">\n                <h3> Lista de personalização </h3>\n            </header>\n\n            <ul>\n                <li v-for="(item, index) in files.images">\n                    <div class="item">\n                        <div class="item__name">\n                            {{ limitLetter(item.name, 18) }}\n                        </div>\n\n                        <div class="item__image">\n                            <img :src="item.src" :alt="item.name"/>\n                        </div>\n                    </div>\n\n                    <div class="item__action" @click="removeCustom(item.id)">\n                        <button class="btn-delete">\n                            Excluir\n                        </button>\n                    </div>\n                </li>\n            </ul>\n        </div>\n    </div> \n</div>';Vue.component("customization-register",{template:$register,data:function(){return{showItens:!1,custom:{category:"",tapy:"",name:"",description:""},files:{images:[],file:"",localFile:"",selected:!1}}},created:function(){},mounted:function(){},methods:{existCustom:function(){var t=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/search?_fields=formatted_name&_where=formatted_name="+t.rewrite(t.custom.category),type:"GET",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},success:function(e){e.length&&swal({type:"error",title:"Oops...",text:'A personalização "'+t.custom.category+'" já foi cadastrada.'})},error:function(e){console.error(e)}})},validadeFieldCategory:function(){var e=this;e.isEmpty(e.custom.category)?swal({type:"error",title:"Oops...",text:"O nome da personalização é obrigatorio"}):e.isEmpty(e.custom.tapy)?swal({type:"error",title:"Oops...",text:"O tipo da personalização é obrigatorio"}):e.showItens=!0},validadeFieldCustom:function(){var e=this;e.isEmpty(e.custom.name)?swal({type:"error",title:"Oops...",text:"O nome da personalização é obrigatorio"}):e.isEmpty(e.files.selected)?swal({type:"error",title:"Oops...",text:"A imagem da personalização é obrigatoria"}):e.inArray(e.custom.name)?swal({type:"error",title:"Oops...",text:'"'+e.custom.name+'" já foi cadastrada.'}):"customized-finishing"==e.custom.tapy&&e.isEmpty(e.custom.description)?swal({type:"error",title:"Oops...",text:"O campo descrição é obrigatorio"}):e.sendCustomData()},sendCustomData:function(){var t=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/documents",type:"POST",dataType:"json",headers:{accept:"application/json","content-type":"application/json"},data:JSON.stringify({category:t.custom.category,tapy:t.custom.tapy,formatted_name:t.rewrite(t.custom.category),active:!0,name:t.custom.name,description:t.custom.description}),success:function(e){t.sendCustomFile(e.DocumentId)},error:function(e){swal({type:"error",title:"Oops...",text:"Houve algum erro ao gravar a personalização tente novamente."})}})},sendCustomFile:function(t,e){var o=this;$.ajax({url:"//api.vtex.com/woodprime/dataentities/PT/documents/"+t+"/image/attachments",type:"POST",data:o.files.file,processData:!1,contentType:!1,mimeType:"multipart/form-data",success:function(e){o.fileReader(t,o.custom.name),o.clearField(),swal({type:"success",title:"cadastrada...",text:"Personalização cadastrada com sucesso."})},error:function(e){swal({type:"error",title:"Oops...",text:"Houve algum erro ao gravar a image da personalização tente novamente."})}})},removeCustom:function(o){var a=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/documents/"+o,type:"DELETE",headers:{accept:"application/json","content-type":"application/json","x-vtex-api-appKey":"vtexappkey-woodprime-NGZJOJ","x-vtex-api-appToken":"BCNGILXMFCMBNJCXBVFWPRBDQGQYUOBXDXRQFPBXFMCLFAGRBIIYTTNJAKQCVYRQAOYPSMSMUHRDPQXPZZWMGDDJKHPUZYCGULKQCRYPPVDMCJTKMACWCEKXLOEKWXMV"},success:function(e){var t=a.files.images.filter(function(e){return e.id!==o});a.files.images=t,swal({type:"error",title:"Removido...",text:"Personalização removida com sucesso."})},error:function(e){console.error(e)}})},clearField:function(){this.custom.name="","customized-finishing"==this.custom.tapy&&(this.custom.description="")},processFile:function(e){var o=this;o.files.file=new FormData,e.target.files.length?o.files.selected=!0:o.files.selected=!1,o.localFile=e.target,$.each(e.target.files,function(e,t){o.files.file.append(e,t)})},inArray:function(t){return 0<this.files.images.filter(function(e){if(e.name==t)return e.name}).length},fileReader:function(t,o){var a=this,e=new FileReader;e.onload=function(e){a.files.images.push({id:t,src:e.target.result,name:o})},e.readAsDataURL(a.localFile.files[0])},rewrite:function(e){if(e)return e.toLowerCase().replace(/[áàãâä]/g,"a").replace(/[éèẽêë]/g,"e").replace(/[íìĩîï]/g,"i").replace(/[óòõôö]/g,"o").replace(/[úùũûü]/g,"u").replace(/ç/g,"c").replace(/(\ |_)+/," ").replace(/(^-+|-+$)/,"").replace(/[^a-z0-9]+/g,"-")},isEmpty:function(e){return null==e||""==e||null==e},limitLetter:function(e,t){if(e&&t){return e.length>t?e.substring(0,t)+"...":e.substring(0,t)}}}});var $html='<div class="product__register">\n    <div class="register__content">\n        <div class="form-controls">\n            <label class="form__label">ID do produto:</label> \n            <input type="text" class="field" placeholder="Digite o ID do produto" v-model="product.id" @keyup.enter="existProduct()">\n        </div>\n\n        <div class="form-controls" v-if="!product.show">\n            <button @click="existProduct()" class="btn"> \n                Cadastrar produto\n            </button>\n        </div>\n    </div>\n\n    <div class="product__content" v-if="product.show">\n        <div class="product">\n            <div class="image">\n                <img :src="product.image" :alt="product.name" width="190" height="150"/>\n            </div>\n\n            <div class="name">\n                <h3> {{ product.name }} </h3>\n                <span> Codigo de referência: {{ product.reference }}  </span>\n            </div>\n        </div>\n\n        <div class="col-fields">\n            <div class="fields" v-for="(item, index) in skus" v-if="skus.length > 1">\n                <div class="form-controls">\n                    <label class="form__label"> {{ item.name }} </label> \n                    <textarea v-model="item.description" class="field-textarea"></textarea>\n                </div>\n\n                <div class="form-controls">\n                    <label class="form__label"> url da imagem: </label> \n                    <input type="text" class="field" v-model="item.url" placeholder="wood-prime-exemplo.png">\n                </div>\n            </div>\n        </div>\n\n        <div class="list__custom">\n            <header class="header-title">\n                <h3> Ative as personalização desejadas </h3>\n            </header>\n\n            <ul class="custom">\n                <li v-for="(item, index) in categorys">\n                    <div class="form__row">\n                        <input type="checkbox" :id="rewrite(item)" :value="rewrite(item)"  v-model="active"/> \n                        <label :for="rewrite(item)" class="label__checkbox"> {{ item }} </label>\n                    </div>\n                </li>\n            </ul>\n        </div>\n\n        <div class="form-controls">\n            <button class="btn btn-finalize" @click="validadeRegister()"> \n                Finalizar cadastro\n            </button>\n        </div>\n    </div>\n</div>';Vue.component("product-register",{template:$html,data:function(){return{product:{id:"",reference:"",name:"",image:"",show:!1},counter:0,skus:[],categorys:[],active:[],JSONCustom:[]}},methods:{existProduct:function(){var t=this;t.isEmpty(t.product.id)?swal({type:"error",title:"Obrigatorio.",text:'O campo "ID do produto" não pode estar em branco.'}):$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PD/search?_fields=idProduct&_where=idProduct="+t.product.id,type:"GET",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},success:function(e){e.length?swal({type:"error",title:"Oops...",text:"Esse ID já esta cadastrado na base."}):(t.getProduct(),t.getCategory())},error:function(e){console.error(e)}})},getProduct:function(){var o=this;$.ajax({url:"/api/catalog_system/pub/products/search/?fq=productId:"+o.product.id,type:"GET",dataType:"json",success:function(e){if(e.length){o.skus=[],o.product.name=e[0].productName,o.product.image=e[0].items[0].images[0].imageUrl,o.product.reference=e[0].productReference,o.product.show=!0;for(var t=0;t<e[0].items.length;t++)o.skus.push({skuId:e[0].items[t].itemId,name:e[0].items[t].name,formatted_name:o.rewrite(e[0].items[t].name),description:""})}else swal({type:"error",title:"Ops...",text:"Não foi encontrado nenhum produto com ID informado."})},error:function(e){console.error(e)}})},getCategory:function(){var o=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/search?_fields=category",type:"GET",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8","REST-range":"resources=0-3000"},success:function(e){for(var t=0;t<e.length;t++)-1==o.categorys.indexOf(e[t].category)&&o.categorys.push(e[t].category)},error:function(e){console.error(e)}})},validadeRegister:function(){this.isEmpty(this.active)?swal({type:"error",title:"Obrigatorio.",text:"Selecione ao menos uma personalização."}):this.finalizeRegister()},finalizeRegister:function(){for(var t=this,e=0;e<t.active.length;e++)$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/search?_fields=id,name,image,tapy,active,description,category&_where=formatted_name="+t.rewrite(t.active[e]),type:"GET",async:!1,headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},success:function(e){t.mountedJsonCustom(e,t.active.length,e[0].category)},error:function(e){console.error(e)}})},mountedJsonCustom:function(e,t,o){for(var a=this,i=[],s=0;s<e.length;s++)e[s].active&&i.push({name:e[s].name,image:"http://woodprime.vtexcrm.com.br/DynamicForm/GetFile?dataEntityInstanceId=PT-"+e[s].id+"&fileName="+e[s].image});a.JSONCustom.push({category_name:o,formatted_name:a.rewrite(o),tapy:e[0].tapy,custom:i}),a.counter!=t-1?a.counter++:a.sendJsonCustom()},sendJsonCustom:function(){var t=this;console.log({idProduct:t.product.id,isCustomized:!0,productName:t.product.name,JSONCustom:t.JSONCustom,skus:t.skus}),$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PD/documents",type:"POST",dataType:"json",headers:{accept:"application/json","content-type":"application/json"},data:JSON.stringify({idProduct:t.product.id,isCustomized:!0,productName:t.product.name,JSONCustom:t.JSONCustom,skus:t.skus}),success:function(e){swal({type:"success",title:"Cadastrado",text:"Produto gravado com sucesso."}),setTimeout(function(){t.resetRegister()},2e3)},error:function(e){swal({type:"error",title:"Oops...",text:"Houve algum erro ao salvar o produto tente novamente."})}})},rewrite:function(e){if(e)return e.toLowerCase().replace(/[áàãâä]/g,"a").replace(/[éèẽêë]/g,"e").replace(/[íìĩîï]/g,"i").replace(/[óòõôö]/g,"o").replace(/[úùũûü]/g,"u").replace(/ç/g,"c").replace(/(\ |_)+/," ").replace(/(^-+|-+$)/,"").replace(/[^a-z0-9]+/g,"-")},isEmpty:function(e){return null==e||""==e||null==e},resetRegister:function(){this.product.id="",this.product.reference="",this.product.name="",this.product.image="",this.product.show=!1,this.counter=0,this.skus=[],this.categorys=[],this.active=[],this.JSONCustom=[]}}});var $list='<div class="custom__list">\n    <div class="custom__btn" v-if="custom[0]">\n        <button class="btn-prev" @click="custom = []">\n            Voltar\n        </button>\n\n        <button class="btn-add-custom" @click="showModal = true" v-show="!showModal"> \n            Adicionar personalização \n        </button>\n\n        <button class="btn-remove-custom" @click="getCustomDelete()"> \n            Excluir toda personalização.\n        </button>\n    </div>\n\n    <div class="list__name__custom" v-if="!custom[0]">\n        <div class="search__list__name__custom">\n            <div class="form-controls">\n                <label class="form__label">Filtrar personalização:</label> \n                <input type="text" placeholder="Filtrar personalização" v-model="search.custom" class="field">\n            </div>\n        </div>\n\n        <ul>\n            <li v-for="(item, index) in categorys" v-show="filterCustom(item)">\n                <div class="item__name">\n                    {{ limitLetter(item, 26) }}\n                </div>\n\n                <div class="item__action">\n                    <button @click="getCustom(item)" class="btn">\n                        Buscar\n                    </button>\n                </div>\n            </li>\n        </ul>\n    </div>\n\n    <div class="add__custom"  v-if="custom[0]" v-show="showModal">\n        <header class="header-title">\n            <h3> Cadastrar personalização </h3>\n        </header>\n\n        <div class="cssload-container" v-if="loader">\n            <div class="cssload-shell">\n                <div class="cssload-double-torus"></div>\n            </div>\x3c!-- /.cssload-container --\x3e\n        </div>\x3c!-- /.cssload-container --\x3e\n\n        <div class="register__content">\n            <div class="form-controls">\n                <label class="form__label">Nome:</label>\n                <input class="field" type="text" id="field__custom__ame" v-model="addCustom.name" placeholder="Nome" autocomplete="off"/> \n            </div>\n\n            <div class="form-controls form-controls-file">\n                <label class="form__label">Imagem:</label>\n                <input type="file" id="customized__image" @change="processFile($event)"/> \n            </div>\n\n            <div class="form-controls form-controls-finishing" v-if="custom[0].tapy == \'customized-finishing\'">\n                <label class="form__label"> Descrição:</label>\n                <textarea class="field__textarea" v-model="addCustom.description"  placeholder="Digite a descrição"></textarea>\n            </div>\n\n            <div class="form-controls">\n                <button class="btn" @click="validadeFieldCustom()">\n                    Cadastrar nova personalização\n                </button>\n            </div>\n        </div> \n    </div>\n\n    <div class="custom__description" v-if="custom[0]">\n        <div class="form-controls">\n            <label class="form__label">Nome da personalização:</label> \n            <input type="text" v-model="selected.category" class="field">\n        </div>\n\n        <div class="shell__default" v-if="custom[0].tapy != \'customized-finishing\'">\n            <div class="form-controls">\n                <label class="form__label">Descrição da personalização:</label> \n                <textarea class="custom__description__textarea" v-model="selected.description"></textarea>\n            </div>\n\n            <button class="btn-update-description" @click="updateCustom()"> \n                Atualizar personalização\n            </button>\n        </div>\n\n        <div class="shell__finishing" v-else>\n            <header class="header-title">\n                <h3> Descrição da personalização </h3>\n            </header>\n\n            <div class="form-controls" v-for="(item, index) in custom">\n                <label class="form__label"> {{ item.name }}:</label>\n                <textarea class="custom__description__textarea" v-model="item.description"></textarea>\n            </div>\n\n            <button class="btn-update-description" @click="updateCustom()" v-if="selected.description"> \n                 Atualizar personalização\n            </button>\n        </div>\n    </div>\n\n    <div class="list-image-custom" v-if="custom[0]">\n        <header class="header-title">\n            <h3> Lista de personalização </h3>\n        </header>\n\n        <div class="search__list__image__custom">\n            <div class="form-controls">\n                <label class="form__label">Filtrar personalização:</label> \n                <input type="text" placeholder="Filtrar personalização" v-model="search.list" class="field">\n            </div>\n        </div>\n\n        <ul>\n            <li v-for="(item, index) in custom"  v-show="filterList(item.name)">\n                <div class="item">\n                    <div class="item__name">\n                        {{ limitLetter(item.name, 20) }}\n                    </div>\n\n                    <div class="item__image">\n                        <img :src="imageSrc(item.id, item.image)" width="190" height="150"/>\n                    </div>\n                </div>\n\n                <div class="item__action">\n                    <button class="btn-disable" v-if="item.active" @click="disableCustom(item.id)"> \n                        desabilitar \n                    </button>\n\n                    <button class="btn-enable" v-if="!item.active" @click="enableCustom(item.id)"> \n                        habilitar \n                    </button>\n\n                    <button class="btn-delete" @click="removeCustom(item.id)">\n                        Excluir\n                    </button>\n                </div>\n            </li>\n        </ul>\n    </div>\n</div>';Vue.component("customization-list",{template:$list,data:function(){return{showModal:!1,loader:!1,categorys:[],custom:[],localFile:"",search:{custom:"",list:""},selected:{name:"",tapy:"",description:"",category:""},addCustom:{show:!1,name:"",file:"",description:"",selected:!1}}},created:function(){this.getCategory()},methods:{getCategory:function(){var o=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/search?_fields=id,category",type:"GET",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8","REST-range":"resources=0-5000"},success:function(e){for(var t=0;t<e.length;t++)-1==o.categorys.indexOf(e[t].category)&&o.categorys.push(e[t].category)},error:function(e){console.error(e)}})},getCustom:function(e){var t=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/search?_fields=id,active,category,description,formatted_name,image,name,tapy&_where=formatted_name="+t.rewrite(e),type:"GET",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8","REST-range":"resources=0-2000"},success:function(e){e.length?(console.log(e),t.custom=e,t.addCustom.show=!1,t.selected.name=e[0].name,t.selected.tapy=e[0].tapy,t.selected.description=e[0].description,t.selected.category=e[0].category):swal({type:"error",title:"Oops...",text:"Houve algum erro ao buscar a personalização tente novamente mais tarde."})},error:function(e){console.error(e)}})},enableCustom:function(t){var o=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/documents/"+t,type:"PATCH",dataType:"json",headers:{accept:"application/json","content-type":"application/json"},data:JSON.stringify({active:!0}),success:function(e){o.addCustom.show=!1,swal({type:"success",title:"Habilitada",text:"A personalização foi habilitada com sucesso."});o.custom.filter(function(e){e.id==t&&(e.active=!0)})},error:function(e){console.error(e)}})},removeCustom:function(t){var o=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/documents/"+t,type:"DELETE",headers:{accept:"application/json","content-type":"application/json","x-vtex-api-appKey":"vtexappkey-woodprime-NGZJOJ","x-vtex-api-appToken":"BCNGILXMFCMBNJCXBVFWPRBDQGQYUOBXDXRQFPBXFMCLFAGRBIIYTTNJAKQCVYRQAOYPSMSMUHRDPQXPZZWMGDDJKHPUZYCGULKQCRYPPVDMCJTKMACWCEKXLOEKWXMV"},success:function(e){o.filter(t),o.addCustom.show=!1},error:function(e){swal({type:"error",title:"Oops...",text:"Houve algum erro ao remover a personalização tente novamente."})}})},filter:function(t){var e=this.custom.filter(function(e){return e.id!==t});this.custom=e,swal({type:"success",title:"Removida...",text:"A personalização foi excluida com sucesso."})},disableCustom:function(t){var o=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/documents/"+t,type:"PATCH",dataType:"json",headers:{accept:"application/json","content-type":"application/json"},data:JSON.stringify({active:!1}),success:function(e){swal({type:"success",title:"Desativada",text:"A personalização foi desativada com sucesso."});o.custom.filter(function(e){e.id==t&&(e.active=!1)})},error:function(e){swal({type:"error",title:"Ops...",text:"Houve algum erro ao gravar ao desabilitar a personalização tente novamente."})}})},updateCustom:function(){var t=this;t.custom.filter(function(e){return $.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/documents/"+e.id,type:"PATCH",dataType:"json",async:!1,headers:{accept:"application/json","content-type":"application/json"},data:JSON.stringify({category:t.selected.category,formatted_name:t.rewrite(t.selected.category),description:t.selected.description}),success:function(e){console.info(e)},error:function(e){console.error(e)}})}).length&&(swal({type:"success",title:"Atualizado",text:"Descrição atializada com sucesso."}),setTimeout(function(){location.href="/customization/list-custom"},2e3))},getCustomDelete:function(){var o=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/search?_fields=id,active,category,description,formatted_name,image,name,tapy&_where=formatted_name="+o.rewrite(o.selected.category),type:"GET",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},success:function(e){for(var t=0;t<e.length;t++)o.deleteCustom(e[t].id)},error:function(e){console.error(e)}})},deleteCustom:function(a){$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/documents/"+a,type:"DELETE",dataType:"json",headers:{accept:"application/json","content-type":"application/json","x-vtex-api-appKey":"vtexappkey-woodprime-NGZJOJ","x-vtex-api-appToken":"BCNGILXMFCMBNJCXBVFWPRBDQGQYUOBXDXRQFPBXFMCLFAGRBIIYTTNJAKQCVYRQAOYPSMSMUHRDPQXPZZWMGDDJKHPUZYCGULKQCRYPPVDMCJTKMACWCEKXLOEKWXMV"},success:function(e,t,o){console.log({"Id:":a,Text:t,Code:o.status})},error:function(e){console.error(e)}})},imageSrc:function(e,t){return"https://woodprime.vtexcrm.com.br/DynamicForm/GetFile?dataEntityInstanceId=PT-"+e+"&fileName="+t},rewrite:function(e){if(e)return e.toLowerCase().replace(/[áàãâä]/g,"a").replace(/[éèẽêë]/g,"e").replace(/[íìĩîï]/g,"i").replace(/[óòõôö]/g,"o").replace(/[úùũûü]/g,"u").replace(/ç/g,"c").replace(/(\ |_)+/," ").replace(/(^-+|-+$)/,"").replace(/[^a-z0-9]+/g,"-")},limitLetter:function(e,t){if(e&&t){return e.length>t?e.substring(0,t)+"...":e.substring(0,t)}},processFile:function(e){var o=this;o.addCustom.file=new FormData,e.target.files.length?o.addCustom.selected=!0:o.addCustom.selected=!1,o.localFile=e.target,$.each(e.target.files,function(e,t){o.addCustom.file.append(e,t)})},validadeFieldCustom:function(){var e=this;e.isEmpty(e.addCustom.name)?swal({type:"error",title:"Obrigatorio...",text:"O nome da personalização é obrigatorio."}):e.isEmpty(e.addCustom.file)?swal({type:"error",title:"Obrigatorio...",text:"A imagem da personalização é obrigatoria."}):"customized-finishing"==e.selected.tapy&&e.isEmpty(e.addCustom.description)?swal({type:"error",title:"Oops...",text:"O campo descrição é obrigatorio"}):e.sendCustomData()},sendCustomData:function(){var t=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/documents",type:"POST",dataType:"json",headers:{accept:"application/json","content-type":"application/json"},data:JSON.stringify({category:t.selected.category,tapy:t.selected.tapy,formatted_name:t.rewrite(t.addCustom.name),active:!0,name:t.addCustom.name,description:t.selected.description}),success:function(e){t.sendCustomFile(e.DocumentId)},error:function(e){swal({type:"error",title:"Ops...",text:"Houve algum erro ao gravar a personalização tente novamente."})}})},sendCustomFile:function(e,t){$.ajax({url:"//api.vtex.com/woodprime/dataentities/PT/documents/"+e+"/image/attachments",type:"POST",data:this.addCustom.file,processData:!1,contentType:!1,mimeType:"multipart/form-data",success:function(e){console.log(">>>>>>>>",e),swal({type:"success",title:"Cadastrada...",text:"Personalização foi cadastrada com sucesso."})},error:function(e){swal({type:"error",title:"Ops...",text:"Houve algum erro ao gravar a personalização tente novamente."})}})},fileReader:function(t,o){var a=this,e=new FileReader;e.onload=function(e){a.custom.push({id:t,src:e.target.result,name:o})},e.readAsDataURL(a.localFile.files[0])},filterCustom:function(e){return 0==e.toLowerCase().indexOf(this.search.custom.toLowerCase())},filterList:function(e){return 0==e.toLowerCase().indexOf(this.search.list.toLowerCase())},isEmpty:function(e){return null==e||""==e||null==e}}});$html='<div class="search__product">\n    <div class="form-controls" v-if="!showItem">\n        <label class="form__label">Buscar produto:</label> \n        <input type="text" placeholder="Buscar produto" class="field" @keyup.enter="getProduct(searchIdProduct)" v-model="searchIdProduct">\n        <button class="btn" @click="getProduct(searchIdProduct)"> Buscar </button>\n    </div>\n\n    <div class="table-info" v-if="!showItem">\n        <table>\n            <tr>\n                <th> ID </th>\n                <th> Nome do produto </th>\n                <th> Status </th>\n                <th></th>\n            </tr>\n\n            <tr v-for="(item, index) in products">\n                <td> {{ item.idProduct }} </td>\n                <td> {{ limitLetter(item.productName, 58) }} </td>\n                <td> {{ statusText(item.isCustomized) }} </td>\n                <td> <button class="btn" @click="getProduct(item.idProduct)"> ver produto</button> </td>\n            </tr>\n        </table>\n    </div>\n\n    <div class="custom__btn"  v-if="showItem">\n        <button class="btn-prev" @click="showItem = false">\n            Voltar\n        </button>\n\n        <button class="btn-action-product desable" v-if="product.status" @click="disableProduct(product.documentId)">\n            Desativar produto\n        </button>\n\n        <button class="btn-action-product active" v-else @click="activeProduct(product.documentId)">\n            Ativar produto\n        </button>\n\n        <button class="btn-action-product desable" @click="deleteProduct(product.documentId)">\n            Excluir produto\n        </button>\n    </div>\n\n    <div class="product__content" v-if="showItem">\n    \t<div class="form-controls">\n    \t\t<label class="form__label">ID do produto:</label> \n    \t\t<input type="text" placeholder="Digite o ID do produto" class="field" v-model="product.id" disabled>\n    \t</div>\n\n    \t<div class="product">\n            <div class="image">\n                <img :src="product.image" :alt="product.name" width="190" height="150"/>\n            </div>\n\n            <div class="name">\n                <h3> {{ product.name }} </h3>\n                <span> Codigo de referência: {{ product.reference }} </span>\n            </div>\n        </div>\n\n        <div class="col-fields">\n            <div class="fields" v-for="(item, index) in product.skus">\n                <div class="form-controls">\n                    <label class="form__label"> {{ item.name }} </label> \n                    <textarea v-model="item.description" class="field-textarea"></textarea>\n                </div>\n\n                <div class="form-controls">\n                    <label class="form__label"> url da imagem:</label> \n                    <input type="text" class="field" v-model="item.url" placeholder="wood-prime-exemplo.png">\n                </div>\n            </div>\n        </div>\n\n        <div class="list__custom">\n            <header class="header-title">\n                <h3> Altere as personalização desejadas </h3>\n            </header>\n\n            <div class="search__list__name__custom">\n\t            <div class="form-controls">\n\t                <label class="form__label">Filtrar personalização:</label> \n\t                <input type="text" placeholder="Filtrar personalização" v-model="searchCustom" class="field">\n\t            </div>\n\t        </div>\n\n            <ul class="custom">\n                <li v-for="(item, index) in categorys" v-show="filterCustom(item)">\n                    <div class="form__row">\n                        <input type="checkbox" :id="rewrite(item)" :value="rewrite(item)" v-model="activeCustomization"/> \n                        <label :for="rewrite(item)" class="label__checkbox"> {{ item }} </label>\n                    </div>\n                </li>\n            </ul>\n        </div>\n\n        <div class="form-controls">\n            <button class="btn btn-finalize" @click="updateProduct()"> \n                Atualizar produto\n            </button>\n        </div>\n    </div>\n</div>';Vue.component("search-product",{template:$html,data:function(){return{searchIdProduct:"",searchCustom:"",products:[],showItem:!1,categorys:[],activeCustomization:[],counterCustomization:0,JSONCustom:[],product:{documentId:"",id:"",status:"",name:"",skus:"",custom:"",image:"",reference:""}}},created:function(){this.getAllProducts()},methods:{getAllProducts:function(){var o=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PD/search?_fields=idProduct,productName,isCustomized",type:"GET",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8","REST-range":"resources=0-30"},success:function(e){for(var t=0;t<e.length;t++)e[t].idProduct&&o.products.push({idProduct:e[t].idProduct,isCustomized:e[t].isCustomized,productName:e[t].productName})},error:function(e){console.error(e)}})},getProduct:function(e){var t=this;t.isEmpty(e)?swal({type:"error",title:"Obrigatorio.",text:"Informe um ID de produto."}):($.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PD/search?_fields=id,idProduct,productName,isCustomized,skus,JSONCustom&_where=idProduct="+e,type:"GET",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},success:function(e){e.length?(t.product.documentId=e[0].id,t.product.id=e[0].idProduct,t.product.status=e[0].isCustomized,t.product.name=e[0].productName,t.product.skus=e[0].skus,t.product.custom=e[0].JSONCustom,t.showItem=!0,t.getCategory(),t.filterCustomizationActive()):swal({type:"error",title:"Ops...",text:"Não foi encontrado nenhum produto com ID fornecido."})},error:function(e){console.error(e)}}),$.ajax({url:"/api/catalog_system/pub/products/search/?fq=productId:"+e,type:"GET",dataType:"json",success:function(e){t.product.image=e[0].items[0].images[0].imageUrl,t.product.reference=e[0].productReference},error:function(e){console.error(e)}}))},activeProduct:function(e){var t=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PD/documents/"+e,type:"PATCH",dataType:"json",headers:{accept:"application/json","content-type":"application/json"},data:JSON.stringify({isCustomized:!0}),success:function(e){swal({type:"success",title:"Desativado",text:"Produto ativado com sucesso."});t.products.filter(function(e){e.idProduct==t.product.id&&e.isCustomized})},error:function(e){console.error(e)}})},disableProduct:function(e){$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PD/documents/"+e,type:"PATCH",dataType:"json",headers:{accept:"application/json","content-type":"application/json"},data:JSON.stringify({isCustomized:!1}),success:function(e){swal({type:"success",title:"Desativado",text:"Produto desativado com sucesso."});_self.products.filter(function(e){e.idProduct==_self.product.id&&e.isCustomized})},error:function(e){console.error(e)}})},getCategory:function(){var o=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/search?_fields=category",type:"GET",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8","REST-range":"resources=0-3000"},success:function(e){for(var t=0;t<e.length;t++)-1==o.categorys.indexOf(e[t].category)&&o.categorys.push(e[t].category)},error:function(e){console.error(e)}})},filterCustomizationActive:function(){for(var e=0;e<this.product.custom.length;e++)this.activeCustomization.push(this.product.custom[e].formatted_name)},updateProduct:function(){for(var t=this,e=0;e<t.activeCustomization.length;e++)$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PT/search?_fields=id,name,image,tapy,active,description,category&_where=formatted_name="+t.activeCustomization[e],type:"GET",async:!1,headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},success:function(e){t.mountedJsonCustom(e,t.activeCustomization.length,e[0].category)},error:function(e){console.error(e)}})},mountedJsonCustom:function(e,t,o){for(var a=this,i=[],s=0;s<e.length;s++)e[s].active&&i.push({name:e[s].name,image:"http://woodprime.vtexcrm.com.br/DynamicForm/GetFile?dataEntityInstanceId=PT-"+e[s].id+"&fileName="+e[s].image,description:e[s].description});a.JSONCustom.push({category_name:o,formatted_name:a.rewrite(o),tapy:e[0].tapy,custom:i}),a.counterCustomization!=t-1?a.counterCustomization++:a.sendJsonCustom()},deleteProduct:function(t){var o=this;swal({title:"Atenção",text:"Tem ceteza que deseja excluir o produto ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Excluir"}).then(function(e){e.value&&$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PD/documents/"+t,type:"DELETE",headers:{accept:"application/json","content-type":"application/json","x-vtex-api-appKey":"vtexappkey-woodprime-NGZJOJ","x-vtex-api-appToken":"BCNGILXMFCMBNJCXBVFWPRBDQGQYUOBXDXRQFPBXFMCLFAGRBIIYTTNJAKQCVYRQAOYPSMSMUHRDPQXPZZWMGDDJKHPUZYCGULKQCRYPPVDMCJTKMACWCEKXLOEKWXMV"},success:function(e){swal("Excluido!","O Produto foi excluido com sucesso.","success"),setTimeout(function(){o.resetSearchProduct()},1500)},error:function(e){swal("Oops...","Houve algum erro ao excluir o produto tente novamente.","error")}})})},sendJsonCustom:function(){var t=this;$.ajax({url:"//api.vtexcrm.com.br/woodprime/dataentities/PD/documents/"+t.product.documentId,type:"PATCH",dataType:"json",headers:{accept:"application/json","content-type":"application/json"},data:JSON.stringify({idProduct:t.product.id,isCustomized:t.product.status,productName:t.product.name,JSONCustom:t.JSONCustom,skus:t.product.skus}),success:function(e){console.log(e),swal({type:"success",title:"Atualizado",text:"Produto atualizado com sucesso."}),setTimeout(function(){t.resetSearchProduct(),t.getAllProducts()},2e3)},error:function(e){swal({type:"error",title:"Oops...",text:"Houve algum erro ao salvar o produto tente novamente."})}})},rewrite:function(e){if(e)return e.toLowerCase().replace(/[áàãâä]/g,"a").replace(/[éèẽêë]/g,"e").replace(/[íìĩîï]/g,"i").replace(/[óòõôö]/g,"o").replace(/[úùũûü]/g,"u").replace(/ç/g,"c").replace(/(\ |_)+/," ").replace(/(^-+|-+$)/,"").replace(/[^a-z0-9]+/g,"-")},statusText:function(e){return 1==e?"Ativado":"Desativado"},isEmpty:function(e){return null==e||""==e||null==e},filterCustom:function(e){return 0==e.toLowerCase().indexOf(this.searchCustom.toLowerCase())},limitLetter:function(e,t){if(e&&t){return e.length>t?e.substring(0,t)+"...":e.substring(0,t)}},resetSearchProduct:function(){this.searchIdProduct="",this.searchCustom="",this.showItem=!1,this.categorys=[],this.activeCustomization=[],this.counterCustomization=0,this.product.documentId="",this.product.id="",this.product.status="",this.product.name="",this.product.skus="",this.product.custom="",this.product.image="",this.product.reference=""}}}),new Vue({el:"#app-customization"});